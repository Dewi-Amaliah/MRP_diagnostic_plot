---
title: "Prelimenary Result"
author: "Dewi Lestari Amaliah - 31251587"
date: "17/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(janitor)
library(kableExtra)
library(patchwork)
```


```{r}
papers <- read_csv(here::here("metadata_july_2.csv"))

```

# Result 

### Plot type - whether it is diagnostic plot or not 

```{r}
papers <- papers %>%
  mutate(Diagnostic = as.factor(Diagnostic))

papers %>%
  group_by(Diagnostic) %>%
  count() %>%
  mutate(pct = round(n/nrow(papers) * 100, 2)) %>%
  kable() %>%
  kable_styling()
```


### The facets

```{r}
filter_facet_all <- papers %>%
  filter(Facets > 1) %>%
  pivot_longer(c(Facet_x, Facet_y), names_to = "facet_axis", values_to = "facet_type") %>%
  group_by(facet_type) %>%
  count()

ggplot(filter(filter_facet_all, !is.na(facet_type))) +
  geom_bar(aes(x = reorder(facet_type, -n), y = n), stat = "identity") +
  theme(axis.text.x = element_text(angle = 10)) +
  xlab("whats in the facet") +
  ylab("count") +
  ggtitle("Overall facet")


```

### Plot types

```{r}
ggplot(papers) +
  geom_bar(aes(y = plot_type, fill = Diagnostic)) +
  facet_wrap(~Diagnostic) +
  theme(legend.position = "none")
```

In this plot, 0 means "communication plot"; 1 means "diagnostic plot"


### Axis type in Communication Plot

```{r}
make_plot_0 <- function(filter_by){
  ggplot(filter(papers, x_axis == filter_by & Diagnostic == 0)) +
    geom_bar(aes(x = y_axis)) +
    ggtitle(paste0("x-axis = ", filter_by))
}
```



```{r}
paper_axis_longer <- papers %>%
  pivot_longer(c(x_axis, y_axis), names_to = "axis_type", values_to = "type")
```


```{r}
ggplot(filter(papers, Diagnostic == 0)) + 
  geom_bar(aes(y = x_axis)) +
  ggtitle("Type of x-axis in communication plot")
```

#### x and y axis pairs in Communication Plots


```{r}
time_p <- make_plot_0("time")
small_area_p <- make_plot_0("small area")
estimates_p <- make_plot_0("estimates")
case_p <- make_plot_0("case")

time_p + small_area_p + estimates_p + case_p
```


### Axis Type in Diagnostic Plots

```{r}
ggplot(filter(papers, Diagnostic == 1)) + 
  geom_bar(aes(y = x_axis)) +
  ggtitle("Type of x-axis in communication plot")
```

```{r}
make_plot_1 <- function(filter_by){
  ggplot(filter(papers, x_axis == filter_by & Diagnostic == 1)) +
    geom_bar(aes(x = y_axis)) +
    ggtitle(paste0("x-axis = ", filter_by))
}
```

```{r}
na_p <- ggplot(filter(papers, is.na(x_axis) & Diagnostic == 1)) +
    geom_bar(aes(x = y_axis)) +
  ggtitle("x-axis = NA")

truth_p <- make_plot_1("truth")
time_p1 <- make_plot_1("time")
small_area_p1 <- make_plot_1("small area")
estimates_p1 <- make_plot_1("estimates")
case_p1 <- make_plot_1("case")
sample_size_p1 <- make_plot_1("sample size")
perf_crit_p1 <- make_plot_1("performance criteria")

na_p + truth_p + time_p1 + small_area_p1 + case_p1 + sample_size_p1
```


```{r}
estimates_p1
```


```{r}
perf_crit_p1

```


### Colors

```{r}
ggplot(papers) + 
  geom_bar(aes(y = color, fill = Diagnostic)) +
  facet_wrap(~Diagnostic) +
  ggtitle("Type of Color")
```


### Shapes

```{r}
ggplot(papers) + 
  geom_bar(aes(y = shape, fill = Diagnostic)) +
  facet_wrap(~Diagnostic) +
  ggtitle("Type of Shapes")
```

### Performance Criteria 

```{r}
paper_perf_crit <- papers %>%
  filter(performance_criteria_bias !=0 |
           performance_criteria_correlation != 0 |
           perfomance_criteria_MAE !=0 |
           performance_criteria_SE != 0 |
           `performance_criteria_MSE/RMSE` != 0) %>%
  pivot_longer(c(performance_criteria_bias,
                 performance_criteria_correlation,
                 perfomance_criteria_MAE,
                 `performance_criteria_MSE/RMSE`,
                 performance_criteria_SE), names_to = "perf_crit",
               values_to = "is_use_perf_crit") %>%
  mutate(is_use_perf_crit = as.factor(is_use_perf_crit))


ggplot(paper_perf_crit, aes(fill=is_use_perf_crit, x=perf_crit)) + 
    geom_bar(position="stack") +
  theme(axis.text.x = element_text(angle = 15)) +
  ggtitle("Type of statistics used as MRP performance criteria") +
  xlab("performance criteria") +
  theme(legend.position = "none")
```

There are 29 (out of 123) plots that use performance criteria as its feature. 
The turquoise color represents the number of plots that use corresponding performance criteria. 
Most of the plots using bias as their performance criteria. 

Regarding, the plot type, plots with performance criteria mostly incorporate dot plots.

```{r}
paper_perf_crit_wide <- papers %>%
  filter(performance_criteria_bias !=0 |
           performance_criteria_correlation != 0 |
           perfomance_criteria_MAE !=0 |
           performance_criteria_SE != 0 |
           `performance_criteria_MSE/RMSE` != 0)

ggplot(paper_perf_crit_wide) +
  geom_bar(aes(y = plot_type)) +
  ggtitle("plot type using performance criteria")

```



### What estimates are compared with MRP?

```{r}
paper_comp <- papers %>%
  filter(comparison_MRP != 0 |
           comparison_other_method != 0 |
           comparison_other_study != 0 |
           comparison_raw != 0 |
           comparison_truth != 0 |
           comparison_weight != 0) %>%
  pivot_longer(c(comparison_MRP,
                 comparison_other_method,
                 comparison_other_study,
                 comparison_raw,
                 comparison_truth, comparison_weight),
                 names_to = "comp_with",
                 values_to = "is_comp_with") %>%
  mutate(is_comp_with = as.factor(is_comp_with))

ggplot(paper_comp, aes(fill=is_comp_with, x=comp_with)) + 
    geom_bar(position="stack") +
  theme(axis.text.x = element_text(angle = 15)) +
  ggtitle("MRP estimates are compared to") +
  xlab("comparison of MRP estimates with") +
  theme(legend.position = "none")
```

There are 67 plots (out of 123) that use comparison as its feature. 
The turquoise color represent the number of plots using corresponding comparison. 
Most of them compare the MRP estimates with the raw data. 


```{r}
paper_comp_wide <- papers %>%
  filter(comparison_MRP != 0 |
           comparison_other_method != 0 |
           comparison_other_study != 0 |
           comparison_raw != 0 |
           comparison_truth != 0 |
           comparison_weight != 0)

ggplot(paper_comp_wide) +
  geom_bar(aes(y = plot_type)) +
  ggtitle("plot type of comparison plots")


```


